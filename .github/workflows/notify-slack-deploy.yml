name: Slack Deploy Notification

on:
  workflow_call:
    inputs:
      status:
        required: true
        type: string
        description: 'success or failure'
    secrets:
      SLACK_BOT_TOKEN:
        required: true
      SLACK_CHANNEL_ID:
        required: true

jobs:
  demodev-lab:
    runs-on: self-hosted
    steps:
      - name: Set short SHA
        run: echo "SHORT_SHA=${GITHUB_SHA::7}" >> $GITHUB_ENV

      - name: Send Slack Notification - Success
        if: inputs.status == 'success'
        continue-on-error: true
        uses: slackapi/slack-github-action@v2.1.1
        with:
          method: chat.postMessage
          token: ${{ secrets.SLACK_BOT_TOKEN }}
          payload: |
            {
              "channel": "${{ secrets.SLACK_CHANNEL_ID }}",
              "text": "Î∞∞Ìè¨Í∞Ä ÏÑ±Í≥µÌñàÏäµÎãàÎã§!",
              "attachments": [
                {
                  "color": "#9C27B0",
                  "blocks": [
                    {
                      "type": "header",
                      "text": {
                        "type": "plain_text",
                        "text": "üöÄ Î∞∞Ìè¨ ÏÑ±Í≥µ",
                        "emoji": true
                      }
                    },
                    {
                      "type": "section",
                      "fields": [
                        {
                          "type": "mrkdwn",
                          "text": "*Î†àÌè¨ÏßÄÌÜ†Î¶¨:*\n`${{ github.repository }}`"
                        },
                        {
                          "type": "mrkdwn",
                          "text": "*Ïª§Î∞ã:*\n`${{ env.SHORT_SHA }}`"
                        },
                        {
                          "type": "mrkdwn",
                          "text": "*Î∏åÎûúÏπò:*\n`${{ github.ref_name }}`"
                        },
                        {
                          "type": "mrkdwn",
                          "text": "*Ïã§ÌñâÏûê:*\n${{ github.actor }}"
                        }
                      ]
                    }
                  ]
                }
              ]
            }

      - name: Send Slack Notification - Failure
        if: inputs.status == 'failure'
        continue-on-error: true
        uses: slackapi/slack-github-action@v2.1.1
        with:
          method: chat.postMessage
          token: ${{ secrets.SLACK_BOT_TOKEN }}
          payload: |
            {
              "channel": "${{ secrets.SLACK_CHANNEL_ID }}",
              "text": "Î∞∞Ìè¨Í∞Ä Ïã§Ìå®ÌñàÏäµÎãàÎã§!",
              "attachments": [
                {
                  "color": "#F44336",
                  "blocks": [
                    {
                      "type": "header",
                      "text": {
                        "type": "plain_text",
                        "text": "‚ùå Î∞∞Ìè¨ Ïã§Ìå®",
                        "emoji": true
                      }
                    },
                    {
                      "type": "section",
                      "fields": [
                        {
                          "type": "mrkdwn",
                          "text": "*Î†àÌè¨ÏßÄÌÜ†Î¶¨:*\n`${{ github.repository }}`"
                        },
                        {
                          "type": "mrkdwn",
                          "text": "*Ïª§Î∞ã:*\n`${{ env.SHORT_SHA }}`"
                        },
                        {
                          "type": "mrkdwn",
                          "text": "*Î∏åÎûúÏπò:*\n`${{ github.ref_name }}`"
                        },
                        {
                          "type": "mrkdwn",
                          "text": "*Ïã§ÌñâÏûê:*\n${{ github.actor }}"
                        }
                      ]
                    },
                    {
                      "type": "section",
                      "text": {
                        "type": "mrkdwn",
                        "text": "*Î°úÍ∑∏:* <${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}|ÏõåÌÅ¨ÌîåÎ°úÏö∞ Î≥¥Í∏∞>"
                      }
                    }
                  ]
                }
              ]
            }